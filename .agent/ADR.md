# Architecture Decision Records

> 프로젝트의 중요한 의사결정과 그 이유를 기록합니다.

---

## ADR-001: 색상 팔레트 하이브리드 전략

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-22 |
| 상태 | 승인됨 |
| 결정 | 보호자 웹앱은 딥블루, 로봇 LCD는 피치/크림 사용 |

### 컨텍스트
- 동행 로봇 서비스는 두 가지 사용자 그룹이 존재
  - 보호자/복지사: 웹앱으로 모니터링
  - 어르신: 로봇 LCD로 직접 상호작용

### 결정 이유
| 사용자 | 색상 | 이유 |
|--------|------|------|
| 복지사/가족 | 딥블루 `#1E3A5F` + 골드 `#D4A574` | 전문성, 신뢰감, 장시간 모니터링에 적합 |
| 어르신 (LCD) | 피치 `#FFAB91` + 크림 `#FFF8F5` | 따뜻함, 친근함, 높은 가독성 |

### 검토된 대안
| 대안 | 기각 이유 |
|------|----------|
| 토스 블루 단일 | 어르신용 LCD에 너무 차가움 |
| 코랄 `#FF6B6B` | 긴급 알림(빨강)과 색상 충돌 |
| 전체 통일 디자인 | 사용자별 니즈가 너무 다름 |

### 결과
- 두 개의 별도 디자인 시스템 운영
- 공통 시맨틱 컬러(safe/warning/danger)는 동일하게 유지

---

## ADR-002: 이모지 → 아이콘 전환

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-22 |
| 상태 | 승인됨 |
| 결정 | 프로토타입의 이모지를 Lucide React 아이콘으로 전환 |

### 컨텍스트
- 기존 Gemini Canvas 프로토타입에서 이모지 사용 (😊, 🏥, 💊 등)
- 빠른 프로토타이핑에는 유용했으나 전문성 부족

### 결정 이유
- 이모지는 OS/브라우저별로 렌더링이 다름
- 전문적인 서비스 느낌 필요
- Lucide는 이미 프로젝트에서 부분적으로 사용 중

### 예외
- 로봇 표정(😊, 😴 등)은 **SVG 커스텀 일러스트** 또는 **Lottie 애니메이션**으로 대체

---

## ADR-003: 로봇 이름 커스터마이징

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-22 |
| 상태 | 승인됨 |
| 결정 | 어르신이 로봇 이름을 직접 명명하도록 함 |

### 컨텍스트
- 로봇과 어르신 간의 정서적 유대감 강화 필요
- 호출어(Wake Word)로 사용

### 결정 이유
- 개인화된 이름은 애착 형성에 도움
- "시리", "알렉사" 같은 고정 이름보다 자연스러움

### 구현 방향
- 설정 화면에서 로봇 이름 변경 기능
- 음성 인식 시 해당 이름으로 호출
- LCD 및 보호자 앱에 이름 반영

---

## ADR-004: 색상 대비 및 접근성 개선

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-23 |
| 상태 | 승인됨 |
| 결정 | 다크 모드 및 LCD 화면의 색상 대비 개선 |

### 컨텍스트
- 다크 모드에서 남색(#1E3A5F) 아이콘이 어두운 배경에서 보이지 않음
- LCD 화면에서 상태바 아이콘(WiFi, 배터리)이 밝은 피치 배경에서 대비 부족
- WCAG AA 4.5:1 대비율 미충족 요소 발견

### 확인된 문제점
| 화면 | 문제 요소 | 현재 색상 | 대비율 |
|------|----------|----------|--------|
| 다크 모드 대시보드 | primary 아이콘 | `#1E3A5F` on `#111827` | ~1.5:1 (실패) |
| LCD 대기 화면 | 상태바 아이콘 | `#9CA3AF` on `#FFF8F5` | ~2.8:1 (실패) |
| LCD 대기 화면 | 온도 텍스트 | `#9CA3AF` on `#FFF8F5` | ~2.8:1 (실패) |

### 결정 내용

#### 1. 다크 모드용 primary 색상 추가
```js
primary: {
  ...기존...
  400: '#6B9BD2',  // 다크 모드용 밝은 블루
}
```

#### 2. LCD 상태바 색상 변경
- 현재: `text-gray-400` (회색)
- 변경: `text-peach-text` (#5D4E37, 웜 브라운)
- 대비율: ~7.2:1 (WCAG AAA 충족)

#### 3. 다크 모드 아이콘 클래스 적용
- 기존: `text-primary-500`
- 변경: `text-primary-500 dark:text-primary-400`

### 검토된 대안
| 대안 | 기각 이유 |
|------|----------|
| 상태바 배경 어둡게 | LCD 피치 테마 정체성 훼손 |
| 아이콘 흰색 사용 | 피치 배경에서 여전히 대비 부족 |
| 그림자 추가 | 복잡성 증가, 성능 영향 |

### 결과
- 모든 화면에서 WCAG AA 4.5:1 이상 충족
- LCD 화면은 AAA 7:1 목표 달성
- 브랜드 색상 정체성 유지

---

## ADR-005: LCD 화면 구성 표준화

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-23 |
| 상태 | 승인됨 |
| 결정 | LCD 화면을 ui-implementation-plan.md 와이어프레임에 정확히 맞춤 |

### 컨텍스트
- Playground에 구현된 LCD 화면이 ui-implementation-plan.md와 불일치
- 로봇 대사가 "할머니~" 손주 말투로 통일되지 않음
- 어르신용 버튼이 충분히 크지 않음

### 결정 내용

#### 1. 불필요한 화면 삭제
| 화면 | 삭제 이유 |
|------|----------|
| 통화 (`call`) | ui-implementation-plan.md에 정의되지 않음 |
| 수면 (`sleep`) | ui-implementation-plan.md에 정의되지 않음 |

#### 2. 대사 통일 (손주 말투)
| 화면 | 대사 |
|------|------|
| 대기 | "할머니~ 오늘도 좋은 하루 되세요!" |
| 인사 | "할머니~ 잘 주무셨어요?" |
| 복약 | "할머니~ 약 드실 시간이에요!" |
| 일정 | "할머니~ 곧 일정이 있어요!" |
| 긴급 | "할머니! 괜찮으세요?!" |
| 충전 | "할머니~ 저 충전할게요" |

#### 3. 초대형 버튼 추가 (80px+)
| 화면 | 버튼 |
|------|------|
| 복약 | [응, 먹었어~], [아직이야~] |
| 일정 | [응, 알겠어~] |
| 긴급 | [😊 괜찮아~], [🚨 도와줘!] |

#### 4. 다크 모드 버튼 접근성 개선
- `variant="dark"` 버튼에 `dark:bg-primary-600` 추가
- 다크 모드에서도 로봇 로그인 버튼이 보이도록 함

### 최종 LCD 화면 목록 (7개)
1. 대기 (`standby`)
2. 인사 (`greeting`)
3. 복약 알림 (`medication`)
4. 일정 알림 (`schedule`)
5. 대화/듣는 중 (`listening`)
6. 긴급/낙상 감지 (`emergency`)
7. 충전 중 (`charging`)

### 결과
- ui-implementation-plan.md와 100% 일치
- 모든 대사 손주 말투 적용
- 어르신 터치 정확도 향상 (80px+ 버튼)

---

## ADR-006: 단일 EC2에서 Nginx 리버스 프록시 + 내부 포트 바인딩

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-29 |
| 상태 | 승인됨 |
| 결정 | Nginx가 80/443을 담당하고, 서비스는 127.0.0.1 내부 포트로만 바인딩 |

### 컨텍스트
- Jenkins, frontend, backend가 동일 EC2에서 동작
- 80/443 포트는 Nginx가 점유, 앱 컨테이너 포트 충돌 발생
- 외부 노출 최소화 및 경로 기반 라우팅 필요

### 결정 내용
- `/` → frontend (127.0.0.1:8081)
- `/api/` → backend (127.0.0.1:8082)
- `/jenkins/` → Jenkins (127.0.0.1:8083)
- Jenkins는 `/jenkins` prefix로 동작하고 직접 포트 노출은 금지

### 검토된 대안
| 대안 | 기각 이유 |
|------|----------|
| 모든 서비스 포트 외부 노출 | 보안 취약, 포트 충돌 |
| 호스트 Nginx 제거 후 컨테이너 Nginx만 사용 | SSL/Certbot 이동 비용 증가 |

### 결과
- 외부 공개 포트 최소화(80/443)
- 경로 기반 라우팅으로 서비스 분리
- Jenkins 보안 강화 및 Webhook 경로 일원화

---

## ADR-007: 프론트 정적 배포를 Docker + Nginx로 구성

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-29 |
| 상태 | 승인됨 |
| 결정 | Vite build 산출물을 Nginx에 배포하고 Docker 이미지로 패키징 |

### 컨텍스트
- 프론트엔드가 SPA(Vite) 기반이며 정적 배포로 충분
- 라우팅 fallback 및 정적 자산 캐시 정책 필요

### 결정 이유
- Docker 기반 배포 일관성 확보
- Nginx로 SPA 라우팅 fallback 및 정적 자산 캐싱 제어 가능

### 결과
- `frontend/Dockerfile`, `frontend/nginx/default.conf` 추가

---

## ADR-008: 다크 모드 클래스 기반 토글 + 로컬 스토리지 유지

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-29 |
| 상태 | 승인됨 |
| 결정 | Tailwind `darkMode: 'class'` + themeStore에서 시스템/로컬 스토리지 모드 관리 |

### 컨텍스트
- 보호자 웹앱의 다크 모드 일관성이 필요
- 사용자/시스템 설정을 모두 지원해야 함

### 결정 이유
- Tailwind 클래스 기반 토글은 제어/테스트가 명확
- 로컬 스토리지로 사용자 선택 유지 가능

### 결과
- `frontend/tailwind.config.js`, `frontend/src/shared/store/themeStore.ts` 반영

---

## ADR-009: Robot LCD 애니메이션을 Framer Motion으로 구현

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-29 |
| 상태 | 승인됨 |
| 결정 | Robot LCD 화면 상태 전환을 Framer Motion으로 구현 |

### 컨텍스트
- LCD 표정/상태 전환에 부드러운 애니메이션 필요
- CSS 애니메이션만으로는 상태 간 전환/제어가 제한적

### 결정 이유
- 상태 기반 애니메이션 제어가 용이
- 시나리오 전환/미리보기 구현이 간단

### 결과
- `frontend/src/pages/Playground/RobotLCD.tsx`에 Framer Motion 도입

---

## ADR-010: 시스템 간 통신 아키텍처

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-29 |
| 상태 | 승인됨 |
| 결정 | REST + WebSocket 혼합 방식, Jetson Orin Nano 단일 통신 대상 |

### 컨텍스트
- 웹앱(보호자), 백엔드(Spring), 로봇(Jetson Orin Nano) 간 통신 방식 정의 필요
- 로봇 하드웨어: Jetson Orin Nano(두뇌) + Arduino(모터/센서)
- 실시간 알림, LCD 미러링, 긴급 상황 처리 요구

### 결정 내용

#### 1. 통신 프로토콜: 혼합 방식
| 프로토콜 | 용도 |
|----------|------|
| **REST API** | CRUD 작업, 상태 조회, 명령 전송 |
| **WebSocket** | 실시간 상태 업데이트, 긴급 알림, LCD 미러링 |

#### 2. 로봇 통신 대상: Jetson Orin Nano만
- 백엔드 ↔ Jetson Orin Nano만 직접 통신
- Arduino는 Jetson 내부 하위 시스템 (Serial/I2C)
- API 명세에서 "Robot"은 Jetson을 의미

```
┌─────────────────────────────┐
│      Robot System           │
│  ┌───────────────────────┐  │
│  │   Jetson Orin Nano    │  │ ← 백엔드와 REST/WebSocket 통신
│  │         │             │  │
│  │    ┌────┴────┐        │  │
│  │    │ Arduino │        │  │ ← 내부 Serial/I2C 통신
│  │    └─────────┘        │  │
│  └───────────────────────┘  │
└─────────────────────────────┘
```

#### 3. 상태 변경 트리거: 로봇 기반
- 로봇(센서/AI)이 상태 변경을 감지하여 서버에 전송
- 서버는 데이터를 수신하고 적절한 화면/알림을 결정
- 오프라인 시 로봇 자체 fallback 동작

| 이벤트 | 트리거 | 서버 처리 |
|--------|--------|----------|
| 낙상 감지 | 로봇 센서 | 긴급 알림 발송, LCD 모드 변경 |
| 복약 시간 | 서버 스케줄 | 로봇에 복약 모드 명령 |
| 음성 일정 등록 | 로봇 AI | 일정 저장, 보호자 알림 |

#### 4. 배포 환경
| 환경 | URL |
|------|-----|
| Client | `https://i14c104.p.ssafy.io/` |
| API | `https://i14c104.p.ssafy.io/api/` |
| WebSocket | `wss://i14c104.p.ssafy.io/ws` |

### 검토된 대안
| 대안 | 기각 이유 |
|------|----------|
| REST only (폴링) | 실시간성 부족, 서버 부하 증가 |
| WebSocket only | 상태 비저장 요청에 오버헤드 |
| MQTT | 추가 인프라 필요, 학습 비용 |

### 관련 문서
- `docs/api-specification.md`: 전체 API 명세
- `docs/ui-implementation-plan.md`: UI 구현 계획

### 결과
- 혼합 방식으로 효율성과 실시간성 균형
- Jetson만 통신하여 API 단순화
- Nginx에 WebSocket 프록시 설정 필요

---

## ADR-011: 4 Agent 병렬 작업 분배 전략

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-02-02 |
| 상태 | 승인됨 |
| 결정 | 4개 AI 에이전트를 도메인별로 분리하여 병렬 작업 |

### 컨텍스트
- PRD v2.0 승인 후 구현 단계 진입
- 개발 속도 향상을 위해 4개의 Codex 에이전트 병렬 실행 계획
- 파일 충돌 없이 독립적 작업 가능한 분배 전략 필요

### 결정 내용

#### 1. Phase 0 분배 (인프라 설정)
| Agent | 역할 | 핵심 산출물 |
|-------|------|------------|
| Agent 1 | BE-INFRA | Spring Boot, Security, Docker |
| Agent 2 | FE-INFRA | Vite, Tailwind, Router |
| Agent 3 | DB-SCHEMA | Flyway, Entity, Repository |
| Agent 4 | CONTRACTS | ApiResponse, Axios, MSW |

#### 2. Phase 1+ 분배 (도메인별)
| Agent | 도메인 | 범위 |
|-------|--------|------|
| Agent 1 | AUTH | 인증/인가 Full-Stack |
| Agent 2 | ELDER | 노인+긴급 Full-Stack |
| Agent 3 | ROBOT | 로봇+스케줄러 Full-Stack |
| Agent 4 | WEBSOCKET | 실시간 통신 Full-Stack |

#### 3. 머지 순서
```
Phase 0: DB-SCHEMA → BE-INFRA → CONTRACTS → FE-INFRA
Phase 1: AUTH(필수) → WEBSOCKET → ELDER/ROBOT(순서 무관)
```

### 결정 이유 (Kent Beck 원칙 적용)

| 원칙 | 적용 |
|------|------|
| **Independence** | 도메인 경계로 분리 → 파일 충돌 최소화 |
| **Contract First** | Phase 0에서 API 응답/타입 먼저 정의 |
| **Tiny Steps** | 1 API = 1 커밋, 즉시 검증 가능 |
| **Always Shippable** | 각 Agent 결과물 독립 동작 |

### 검토된 대안

| 대안 | 기각 이유 |
|------|----------|
| 레이어별 분리 (BE/FE/DB/Test) | API가 Entity 의존 → 순차적 병목 |
| Phase별 순차 실행 | 병렬화 이점 없음 |
| 기능별 세분화 (10+ Agent) | 관리 복잡도 증가 |

### 관련 문서
- `.agent/PARALLEL-WORK.md`: 상세 분배 전략
- `CLAUDE.md`: 병렬 작업 규칙 섹션

### 결과
- 4개 에이전트 동시 작업 가능
- 파일 소유권 명확화로 충돌 방지
- 싱크 포인트로 통합 품질 보장

---

## 🔄 업데이트 이력

| 날짜 | ADR | 변경 |
|------|-----|------|
| 2026-01-22 | ADR-001 | 초기 작성 |
| 2026-01-22 | ADR-002 | 초기 작성 |
| 2026-01-22 | ADR-003 | 초기 작성 |
| 2026-01-23 | ADR-004 | 색상 대비 개선 결정 추가 |
| 2026-01-23 | ADR-005 | LCD 화면 구성 표준화 |
| 2026-01-29 | ADR-006 | Nginx 리버스 프록시 구성 |
| 2026-01-29 | ADR-007 | 프론트 Docker+Nginx 배포 |
| 2026-01-29 | ADR-008 | 다크 모드 클래스 기반 토글 |
| 2026-01-29 | ADR-009 | LCD Framer Motion 애니메이션 |
| 2026-01-29 | ADR-010 | 시스템 간 통신 아키텍처 |
| 2026-02-02 | ADR-011 | 4 Agent 병렬 작업 분배 전략 |
